manifest {
    mainScript = './main.nf'
}


params{
    assembler = ''
    polish = "skip"
//    cpus = 4
//    mem = "8GB"
}


// need --output
//if (params.output == '') {
//    exit 1, "--output is a required parameter"
//}

//if (params.polish == "skip") {
//    println("Parameter --polish empty, no polishing step will be done \nIf you want polishing chose either 'medaka' 'racon' or 'both' in --polish")
//}

profiles {
    
    conda {
        executor {
        name   = 'local'
        cpus   = 16
        memory = '64GB'
        }
        docker.enabled=false

        process {

            withName:assembly_p {
                if (params.assembler == 'metaspades') {
                    conda = 'bioconda::spades'
                    }
                else if (params.assembler == 'metaflye') {
                    conda = 'bioconda::flye'
                }
            }

            withName:polishing {
                if (params.polish == 'medaka') {
                    conda = 'bioconda::medaka'
                }
                else if (params.polish == 'racon') {
                    conda = 'bioconda::racon bioconda::minimap2'
                }
                else if (params.polish == 'both') {
                    conda = 'bioconda::medaka bioconda::racon bioconda::minimap2'
                }
                else if (params.polish == 'skip') {
                    conda = ''
                }
            }

            // withName:assembly_qc {
            //    conda = 'metaquast'
            // }

            withName:assembly_mapping{
                conda = 'bioconda::minimap2 bioconda::bwa'
            }

            withName:binning{
                conda = 'bioconda::metabat2'
            }
        }
    }




    // standard {
    //         executor = 'local'
    //         docker.enabled = true

    //         process {
    //             withName:assembly_p{
    //                 if (params.assembler == 'metaspades') {
    //                     container = 'TBD/spades'
    //                     }
    //                 else if (params.assembler == 'metaflye') {
    //                     container = 'TBD/flye'
    //                 }
    //             }
    //                 withName:polishing{
    //                     if (params.polish == 'medaka') {
    //                         container = 'TBD/medaka'
    //                     }
    //                     else if (params.polish == 'racon') {
    //                         container = 'TBD/racon,TBD/minimap2'
    //                     }
    //                     else if (params.polish == 'both') {
    //                         container = 'TBD/medaka,TBD/racon,TBD/minimap2'
    //                     }
    //                 }

    //              // withName:assembly_qc{
    //              //   container = 'TBD/metaquast'
    //              //}

    //             withName:assembly_mapping{
    //                 container = 'TBD/minimap2,bwa'
    //             }

    //             withName:binning{
    //                 container = 'TBD/metabat2'
    //             }
    //         }
    //     }

    //     planet {
    //         executor = 'sge'
    //         docker.enabled = false

    //         process {
    //             withName:assembly_p{
    //                 clusterOptions = '-S /bin/bash -l h_vmem=1G'
    //                 penv = 'smp'
    //                 if (params.assembler == 'metaspades') {
    //                     time = '24h'
    //                     module = 'spades'
    //                     }
    //                 else if (params.assembler == 'metaflye') {
    //                     time = '24h'
    //                     module = 'flye'
    //                 }
    //             }
    //                 withName:polishing{
    //                     clusterOptions = '-S /bin/bash -l h_vmem=1G'
    //                     penv = 'smp'
    //                     if (params.polish == 'medaka') {
    //                         time = '24h'
    //                         module = 'medaka'
    //                     }
    //                     else if (params.polish == 'racon') {
    //                         time = '24h'
    //                         module = 'racon,minimap2'
    //                     }
    //                     else if (params.polish == 'both') {
    //                         time = '24h'
    //                         module = 'medaka,racon,minimap2'
    //                     }
    //                 }

    //            // withName:assembly_qc{
    //            //     clusterOptions = '-S /bin/bash -l h_vmem=1G'
    //            //     time = '24h'
    //            //     penv = 'smp'
    //            //     module = 'metaquast'
    //            // }

    //             withName:assembly_mapping{
    //                 clusterOptions = '-S /bin/bash -l h_vmem=1G'
    //                 time = '24h'
    //                 penv = 'smp'
    //                 module = 'minimap2,bwa'
    //             }

    //             withName:binning{
    //                 clusterOptions = '-S /bin/bash -l h_vmem=1G'
    //                 time = '24h'
    //                 penv = 'smp'
    //                 module = 'metabat2'
    //             }
    //         }
    //     }



}